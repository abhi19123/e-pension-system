<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pension Application Form</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .form-section {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .required:after {
            content: " *";
            color: red;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h2 class="mb-4">Pension Application Form</h2>
        
        <form id="pensionForm" class="needs-validation" enctype="multipart/form-data" novalidate>
            <!-- Personal Information -->
            <div class="form-section">
                <h4>Personal Information</h4>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="aadharNumber" class="form-label required">Aadhar Number</label>
                        <input type="text" class="form-control" id="aadharNumber" name="aadharNumber" required
                               pattern="[0-9]{12}" title="Please enter valid 12-digit Aadhar number">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="panNumber" class="form-label required">PAN Number</label>
                        <input type="text" class="form-control" id="panNumber" name="panNumber" required
                               pattern="[A-Z]{5}[0-9]{4}[A-Z]{1}" title="Please enter valid PAN number">
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="dateOfBirth" class="form-label required">Date of Birth</label>
                        <input type="date" class="form-control" id="dateOfBirth" name="dateOfBirth" required>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="gender" class="form-label required">Gender</label>
                        <select class="form-select" id="gender" name="gender" required>
                            <option value="">Select Gender</option>
                            <option value="MALE">Male</option>
                            <option value="FEMALE">Female</option>
                            <option value="OTHER">Other</option>
                        </select>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="maritalStatus" class="form-label required">Marital Status</label>
                        <select class="form-select" id="maritalStatus" name="maritalStatus" required>
                            <option value="">Select Status</option>
                            <option value="SINGLE">Single</option>
                            <option value="MARRIED">Married</option>
                            <option value="WIDOWED">Widowed</option>
                            <option value="DIVORCED">Divorced</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Contact Information -->
            <div class="form-section">
                <h4>Contact Information</h4>
                <div class="mb-3">
                    <label for="permanentAddress" class="form-label required">Permanent Address</label>
                    <textarea class="form-control" id="permanentAddress" name="permanentAddress" rows="3" required></textarea>
                </div>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="city" class="form-label required">City</label>
                        <input type="text" class="form-control" id="city" name="city" required>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="state" class="form-label required">State</label>
                        <select class="form-select" id="state" name="state" required>
                            <option value="">Select State</option>
                            <option value="AP">Andhra Pradesh</option>
                            <option value="AR">Arunachal Pradesh</option>
                            <!-- Add all states -->
                        </select>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="pinCode" class="form-label required">PIN Code</label>
                        <input type="text" class="form-control" id="pinCode" name="pinCode" required
                               pattern="[0-9]{6}" title="Please enter valid 6-digit PIN code">
                    </div>
                </div>
            </div>

            <!-- Bank Details -->
            <div class="form-section">
                <h4>Bank Details</h4>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="bankName" class="form-label required">Bank Name</label>
                        <input type="text" class="form-control" id="bankName" name="bankName" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="accountNumber" class="form-label required">Account Number</label>
                        <input type="text" class="form-control" id="accountNumber" name="accountNumber" required>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="ifscCode" class="form-label required">IFSC Code</label>
                        <input type="text" class="form-control" id="ifscCode" name="ifscCode" required
                               pattern="^[A-Z]{4}0[A-Z0-9]{6}$" title="Please enter valid IFSC code">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="branchName" class="form-label required">Branch Name</label>
                        <input type="text" class="form-control" id="branchName" name="branchName" required>
                    </div>
                </div>
            </div>

            <!-- Employment Details -->
            <div class="form-section">
                <h4>Employment Details</h4>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="lastEmployer" class="form-label required">Last Employer</label>
                        <input type="text" class="form-control" id="lastEmployer" name="lastEmployer" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="employeeId" class="form-label required">Employee ID</label>
                        <input type="text" class="form-control" id="employeeId" name="employeeId" required>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="retirementDate" class="form-label required">Retirement Date</label>
                        <input type="date" class="form-control" id="retirementDate" name="retirementDate" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="lastDrawnSalary" class="form-label required">Last Drawn Salary (â‚¹)</label>
                        <input type="number" class="form-control" id="lastDrawnSalary" name="lastDrawnSalary" required>
                    </div>
                </div>
            </div>

            <!-- Document Upload -->
            <div class="form-section">
                <h4>Document Upload</h4>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="aadharCard" class="form-label required">Aadhar Card</label>
                        <input type="file" class="form-control" id="aadharCard" name="aadharCard" accept=".pdf,.jpg,.jpeg,.png" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="panCard" class="form-label required">PAN Card</label>
                        <input type="file" class="form-control" id="panCard" name="panCard" accept=".pdf,.jpg,.jpeg,.png" required>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="bankPassbook" class="form-label required">Bank Passbook</label>
                        <input type="file" class="form-control" id="bankPassbook" name="bankPassbook" accept=".pdf,.jpg,.jpeg,.png" required>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="retirementProof" class="form-label required">Retirement Proof</label>
                        <input type="file" class="form-control" id="retirementProof" name="retirementProof" accept=".pdf,.jpg,.jpeg,.png" required>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="photograph" class="form-label required">Recent Photograph</label>
                        <input type="file" class="form-control" id="photograph" name="photograph" accept=".jpg,.jpeg,.png" required>
                    </div>
                </div>
            </div>

            <!-- Additional Information -->
            <div class="form-section">
                <h4>Additional Information</h4>
                <div class="mb-3">
                    <label for="remarks" class="form-label">Remarks</label>
                    <textarea class="form-control" id="remarks" name="remarks" rows="3"></textarea>
                </div>
                <div class="mb-3">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="declarationAccepted" name="declarationAccepted" required>
                        <label class="form-check-label required" for="declarationAccepted">
                            I hereby declare that all the information provided above is true and correct to the best of my knowledge.
                        </label>
                    </div>
                </div>
            </div>

            <button type="submit" class="btn btn-primary mb-5">Submit Application</button>
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.getElementById('pensionForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!this.checkValidity()) {
                e.stopPropagation();
                this.classList.add('was-validated');
                return;
            }

            const formData = new FormData();
            const applicationData = {
                aadharNumber: document.getElementById('aadharNumber').value,
                panNumber: document.getElementById('panNumber').value,
                dateOfBirth: document.getElementById('dateOfBirth').value,
                gender: document.getElementById('gender').value,
                maritalStatus: document.getElementById('maritalStatus').value,
                permanentAddress: document.getElementById('permanentAddress').value,
                city: document.getElementById('city').value,
                state: document.getElementById('state').value,
                pinCode: document.getElementById('pinCode').value,
                bankName: document.getElementById('bankName').value,
                accountNumber: document.getElementById('accountNumber').value,
                ifscCode: document.getElementById('ifscCode').value,
                branchName: document.getElementById('branchName').value,
                lastEmployer: document.getElementById('lastEmployer').value,
                employeeId: document.getElementById('employeeId').value,
                retirementDate: document.getElementById('retirementDate').value,
                lastDrawnSalary: document.getElementById('lastDrawnSalary').value,
                remarks: document.getElementById('remarks').value,
                declarationAccepted: document.getElementById('declarationAccepted').checked
            };

            formData.append('application', new Blob([JSON.stringify(applicationData)], {
                type: 'application/json'
            }));
            formData.append('aadharCard', document.getElementById('aadharCard').files[0]);
            formData.append('panCard', document.getElementById('panCard').files[0]);
            formData.append('bankPassbook', document.getElementById('bankPassbook').files[0]);
            formData.append('retirementProof', document.getElementById('retirementProof').files[0]);
            formData.append('photograph', document.getElementById('photograph').files[0]);

            try {
                const response = await fetch('/api/pension/apply', {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    alert('Application submitted successfully!');
                    window.location.href = '/track-application';
                } else {
                    const error = await response.text();
                    alert('Error submitting application: ' + error);
                }
            } catch (error) {
                alert('Error submitting application: ' + error.message);
            }
        });
    </script>
</body>
</html>
